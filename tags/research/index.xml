<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>research on Jojo's Exceptions</title><link>https://exception.blog/tags/research/</link><description>Recent content in research on Jojo's Exceptions</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 06 Jul 2021 23:38:32 -0300</lastBuildDate><atom:link href="https://exception.blog/tags/research/index.xml" rel="self" type="application/rss+xml"/><item><title>Analisando plguins wordpress em massa</title><link>https://exception.blog/posts/analisando-plugins-wordpress-em-massa/</link><pubDate>Tue, 06 Jul 2021 23:38:32 -0300</pubDate><guid>https://exception.blog/posts/analisando-plugins-wordpress-em-massa/</guid><description>Acredito que a grande maioria do pessoal que procura vulnerabilidades rentáveis dentro do mundo de aplicações web, em algum momento já passou pela stack que o WordPress fornece, seja auditando seu core, ou plugins, sendo este último o foco dessa postagem.
Junto a um simples crawler escrito em C# 9.0 (só não usei os recursos do 10 pois não havia necessidade de delegates), vamos percorrer todos os plugins listáveis na index do site do projeto, e organiza-lo em uma estrutura contendo o próprio .</description><content>&lt;p>Acredito que a grande maioria do pessoal que procura vulnerabilidades rentáveis dentro do mundo de aplicações web, em algum momento já passou pela &lt;em>stack&lt;/em> que o WordPress fornece, seja auditando seu &lt;code>core&lt;/code>, ou plugins, sendo este último o foco dessa postagem.&lt;/p>
&lt;p>Junto a um simples &lt;em>crawler&lt;/em> escrito em C# 9.0 (só não usei os recursos do 10 pois não havia necessidade de &lt;code>delegates&lt;/code>), vamos percorrer todos os &lt;em>plugins&lt;/em> listáveis na &lt;em>index&lt;/em> do site do projeto, e organiza-lo em uma estrutura contendo o próprio &lt;code>.zip&lt;/code> com o código do plugin.&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Nota&lt;/strong>: Caso tenha interesse em apenas utilizar o &lt;em>crawler&lt;/em>, verifique-o no código em &lt;em>highlight&lt;/em> logo abaixo.&lt;/p>
&lt;/blockquote>
&lt;h1 id="top-level-program">Top-level program&lt;/h1>
&lt;p>Por não haver a necessidade de termos uma estrutura de programa complexa, vamos utilizar os recursos que o C# 9.0 tem de melhor, em trazer minimalismo na hora de construir uma aplicação de linha de comando: Com &lt;em>top-level programs&lt;/em>. Dentro dessa linguagem, essa caracteristica permite que escvrevamos código, sem o &lt;em>template&lt;/em> clássico do &lt;code>static void Main()&lt;/code>.&lt;/p>
&lt;p>&lt;img src="https://exception.blog/static/26f475e9f2a847fe0bbf2eab.png" alt="Apresentação do site">&lt;/p>
&lt;p>Para análisar o HTML da página, e não passar raiva ou perder tempo com expressões regulares ou ficar refém de algo como &lt;code>LastIndexOf()&lt;/code> ou &lt;code>IndexOf()&lt;/code>, irei utilizar o &lt;code>AngleParse&lt;/code> como biblioteca para realizar o &lt;em>parsing&lt;/em> da sopa de letras que vamos extrair do site exibido acima. Um ponto de atenção na hora de fazer o &lt;em>crawling&lt;/em>, é justamente se antentar onde será realizado, tendo em vista que a listagem completa dos quase 60 mil plugins não é possível.&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Nota&lt;/strong>: Também vamos fazer tudo isso assíncrono e paralelo, utilizando &lt;code>async&lt;/code> e &lt;code>SemaphoreSlim&lt;/code>.&lt;/p>
&lt;/blockquote>
&lt;p>Ah, e seguindo a linha das outras postagens, o código vou escrevendo conforme vou conseguindo tempo no meu dia-a-dia, por tanto essa postagem também se remete a essa condição, e pode ser atualizada constantemente conforme meu humor varie. Caso tenha visto alguma coisa que alterou, todo o blog está disponível em meu GitHub no &lt;code>/exception&lt;/code>.&lt;/p>
&lt;p>Sem mais esperneios, vamos ao código-fonte. Esse que talvez não seja muito &lt;em>begginers friendly&lt;/em>, tendo em vista a utilização de recursos bem avançados do C#, porém, ainda contendo esse tipo de código, sua legibilidade é realmente simples:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;span style="color:#66d9ef">using&lt;/span> System.IO;
&lt;span style="color:#66d9ef">using&lt;/span> System.Net;
&lt;span style="color:#66d9ef">using&lt;/span> System.Linq;
&lt;span style="color:#66d9ef">using&lt;/span> System.Net.Http;
&lt;span style="color:#66d9ef">using&lt;/span> System.Threading;
&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Generic;
&lt;span style="color:#66d9ef">using&lt;/span> System.Collections.Concurrent;
&lt;span style="color:#66d9ef">using&lt;/span> AngleSharp.Html.Dom;
&lt;span style="color:#66d9ef">using&lt;/span> AngleSharp.Html.Parser;
&lt;span style="color:#66d9ef">using&lt;/span> static System.Console;
&lt;span style="color:#66d9ef">var&lt;/span> clientHandler = &lt;span style="color:#66d9ef">new&lt;/span> HttpClientHandler
{
AllowAutoRedirect = &lt;span style="color:#66d9ef">false&lt;/span>,
UseCookies = &lt;span style="color:#66d9ef">true&lt;/span>,
CookieContainer = &lt;span style="color:#66d9ef">new&lt;/span> CookieContainer()
};
&lt;span style="color:#66d9ef">var&lt;/span> client = &lt;span style="color:#66d9ef">new&lt;/span> HttpClient(clientHandler);
&lt;span style="color:#66d9ef">var&lt;/span> parser = &lt;span style="color:#66d9ef">new&lt;/span> HtmlParser();
&lt;span style="color:#66d9ef">var&lt;/span> semaphore = &lt;span style="color:#66d9ef">new&lt;/span> SemaphoreSlim(Environment.ProcessorCount);
&lt;span style="color:#66d9ef">var&lt;/span> downloadList = &lt;span style="color:#66d9ef">new&lt;/span>[]
{
&lt;span style="color:#e6db74">&amp;#34;https://wordpress.org/plugins/browse/popular/&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;https://wordpress.org/plugins/browse/beta/&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;https://wordpress.org/plugins/browse/featured/&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;https://wordpress.org/plugins/browse/blocks/&amp;#34;&lt;/span>
};
WriteLine(&lt;span style="color:#e6db74">&amp;#34;[+] Crawler started with a possible total of {0} thread(s)&amp;#34;&lt;/span>, Environment.ProcessorCount);
&lt;span style="color:#66d9ef">var&lt;/span> pluginsPages = &lt;span style="color:#66d9ef">new&lt;/span> ConcurrentBag&amp;lt;&lt;span style="color:#66d9ef">string&lt;/span>&amp;gt;();
&lt;span style="color:#66d9ef">async&lt;/span> Task GetAllPluginsPagesAsync(&lt;span style="color:#66d9ef">string&lt;/span> target)
{
&lt;span style="color:#66d9ef">await&lt;/span> semaphore.WaitAsync();
&lt;span style="color:#66d9ef">var&lt;/span> response = &lt;span style="color:#66d9ef">await&lt;/span> client.GetAsync(target);
&lt;span style="color:#66d9ef">if&lt;/span> (!response.IsSuccessStatusCode) &lt;span style="color:#66d9ef">return&lt;/span>;
&lt;span style="color:#66d9ef">var&lt;/span> counter = &lt;span style="color:#ae81ff">2&lt;/span>;
&lt;span style="color:#66d9ef">while&lt;/span> (&lt;span style="color:#66d9ef">true&lt;/span>)
{
&lt;span style="color:#66d9ef">var&lt;/span> content = &lt;span style="color:#66d9ef">await&lt;/span> response.Content.ReadAsStringAsync();
&lt;span style="color:#66d9ef">var&lt;/span> soup = &lt;span style="color:#66d9ef">await&lt;/span> parser.ParseDocumentAsync(content);
&lt;span style="color:#66d9ef">var&lt;/span> navs = soup.All
.Where(e =&amp;gt; e.LocalName == &lt;span style="color:#e6db74">&amp;#34;div&amp;#34;&lt;/span> &amp;amp;&amp;amp; e.GetAttribute(&lt;span style="color:#e6db74">&amp;#34;class&amp;#34;&lt;/span>) == &lt;span style="color:#e6db74">&amp;#34;nav-links&amp;#34;&lt;/span>)
.ToList();
&lt;span style="color:#66d9ef">if&lt;/span> (navs.Count == &lt;span style="color:#ae81ff">0&lt;/span>)
{
pluginsPages.Add(content);
&lt;span style="color:#66d9ef">break&lt;/span>;
}
pluginsPages.Add(content);
response = &lt;span style="color:#66d9ef">await&lt;/span> client.GetAsync(target + &lt;span style="color:#e6db74">$&amp;#34;page/{counter}/&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">if&lt;/span> (!response.IsSuccessStatusCode) &lt;span style="color:#66d9ef">break&lt;/span>;
counter += &lt;span style="color:#ae81ff">1&lt;/span>;
}
semaphore.Release();
}
&lt;span style="color:#66d9ef">var&lt;/span> downloadTasks = &lt;span style="color:#66d9ef">new&lt;/span> List&amp;lt;Task&amp;gt;();
downloadList.ToList().ForEach(d =&amp;gt; downloadTasks.Add(GetAllPluginsPagesAsync(d)));
&lt;span style="color:#66d9ef">await&lt;/span> Task.WhenAll(downloadTasks);
WriteLine(&lt;span style="color:#e6db74">&amp;#34;[+] Downloaded {0} page(s) with unique plugins from WordPress&amp;#34;&lt;/span>, pluginsPages.Count);
&lt;span style="color:#66d9ef">var&lt;/span> pluginPages = &lt;span style="color:#66d9ef">new&lt;/span> ConcurrentBag&amp;lt;&lt;span style="color:#66d9ef">string&lt;/span>&amp;gt;();
&lt;span style="color:#66d9ef">async&lt;/span> Task GetPluginPageAsync(&lt;span style="color:#66d9ef">string&lt;/span> page)
{
&lt;span style="color:#66d9ef">await&lt;/span> semaphore.WaitAsync();
&lt;span style="color:#66d9ef">var&lt;/span> soup = &lt;span style="color:#66d9ef">await&lt;/span> parser.ParseDocumentAsync(page);
&lt;span style="color:#66d9ef">var&lt;/span> headers = soup.All
.Where(e =&amp;gt; e.LocalName == &lt;span style="color:#e6db74">&amp;#34;h3&amp;#34;&lt;/span> &amp;amp;&amp;amp; e.GetAttribute(&lt;span style="color:#e6db74">&amp;#34;class&amp;#34;&lt;/span>) == &lt;span style="color:#e6db74">&amp;#34;entry-title&amp;#34;&lt;/span>)
.Select(e =&amp;gt; e.InnerHtml)
.ToList();
&lt;span style="color:#66d9ef">if&lt;/span> (headers.Count &amp;lt;= &lt;span style="color:#ae81ff">0&lt;/span>) &lt;span style="color:#66d9ef">return&lt;/span>;
headers.ForEach(&lt;span style="color:#66d9ef">async&lt;/span> c =&amp;gt;
{
&lt;span style="color:#66d9ef">var&lt;/span> anchor = &lt;span style="color:#66d9ef">await&lt;/span> parser.ParseDocumentAsync(c);
&lt;span style="color:#66d9ef">if&lt;/span> (anchor.All.FirstOrDefault(e =&amp;gt; e.LocalName == &lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>) &lt;span style="color:#66d9ef">is&lt;/span> not IHtmlAnchorElement href) &lt;span style="color:#66d9ef">return&lt;/span>;
pluginPages.Add(href.Href);
});
semaphore.Release();
}
&lt;span style="color:#66d9ef">var&lt;/span> parserTasks = &lt;span style="color:#66d9ef">new&lt;/span> List&amp;lt;Task&amp;gt;();
pluginsPages.ToList().ForEach(p =&amp;gt; parserTasks.Add(GetPluginPageAsync(p)));
&lt;span style="color:#66d9ef">await&lt;/span> Task.WhenAny(parserTasks);
&lt;span style="color:#66d9ef">var&lt;/span> pluginsPagesUniq = pluginPages.Distinct().ToList();
WriteLine(&lt;span style="color:#e6db74">&amp;#34;[+] Downloaded {0} plugin page(s)&amp;#34;&lt;/span>, pluginsPagesUniq.Count);
&lt;span style="color:#66d9ef">if&lt;/span> (!Directory.Exists(&lt;span style="color:#e6db74">&amp;#34;output&amp;#34;&lt;/span>)) Directory.CreateDirectory(&lt;span style="color:#e6db74">&amp;#34;output&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">async&lt;/span> Task DownloadPluginAsync(&lt;span style="color:#66d9ef">string&lt;/span> href)
{
&lt;span style="color:#66d9ef">await&lt;/span> semaphore.WaitAsync();
&lt;span style="color:#66d9ef">var&lt;/span> response = &lt;span style="color:#66d9ef">await&lt;/span> client.GetAsync(href);
&lt;span style="color:#66d9ef">var&lt;/span> content = &lt;span style="color:#66d9ef">await&lt;/span> response.Content.ReadAsStringAsync();
&lt;span style="color:#66d9ef">var&lt;/span> soup = &lt;span style="color:#66d9ef">await&lt;/span> parser.ParseDocumentAsync(content);
&lt;span style="color:#66d9ef">if&lt;/span> (soup.All.FirstOrDefault(e =&amp;gt; e.LocalName == &lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span> &amp;amp;&amp;amp;
e.GetAttribute(&lt;span style="color:#e6db74">&amp;#34;class&amp;#34;&lt;/span>) ==
&lt;span style="color:#e6db74">&amp;#34;plugin-download button download-button button-large&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">is&lt;/span> not IHtmlAnchorElement downloadLink) &lt;span style="color:#66d9ef">return&lt;/span>;
response = &lt;span style="color:#66d9ef">await&lt;/span> client.GetAsync(downloadLink.Href);
&lt;span style="color:#66d9ef">var&lt;/span> streamContent = &lt;span style="color:#66d9ef">await&lt;/span> response.Content.ReadAsStreamAsync();
&lt;span style="color:#66d9ef">var&lt;/span> pluginFileName = downloadLink.Href.Split(&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>).Last();
WriteLine(&lt;span style="color:#e6db74">&amp;#34;[+] Downloading file {0}...&amp;#34;&lt;/span>, pluginFileName);
&lt;span style="color:#66d9ef">var&lt;/span> path = Path.Combine(&lt;span style="color:#e6db74">&amp;#34;output&amp;#34;&lt;/span>, pluginFileName);
&lt;span style="color:#66d9ef">await&lt;/span> &lt;span style="color:#66d9ef">using&lt;/span> var stream = &lt;span style="color:#66d9ef">new&lt;/span> FileStream(path, FileMode.CreateNew);
streamContent.Seek(&lt;span style="color:#ae81ff">0&lt;/span>, SeekOrigin.Begin);
streamContent.CopyTo(stream);
semaphore.Release();
}
&lt;span style="color:#66d9ef">var&lt;/span> downloadPluginTasks = &lt;span style="color:#66d9ef">new&lt;/span> List&amp;lt;Task&amp;gt;();
pluginsPagesUniq.ForEach(l =&amp;gt; downloadPluginTasks.Add(DownloadPluginAsync(l)));
&lt;span style="color:#66d9ef">await&lt;/span> Task.WhenAll(downloadPluginTasks);
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Basicamente, na primeira etapa do código, inicializamos uma lista contendo as URLs de todos os alvos que vamos utilizar para popular a segunda lista concorrente, que é representada pela própria pagína do plugin.&lt;/p>
&lt;p>Na sequência, pegamos essa mesma listagem de páginas, e extraimos somente as URLs para download dos plugins. Por fim, temos individualmente todas as páginas dos plugins para download, e então, realizam-se o tal ato.&lt;/p>
&lt;p>Caso você for realizar o &lt;em>debugging&lt;/em>, em especial na altura da lógica correspondente a lista &lt;code>pluginsPagesUniq&lt;/code>, você pode se perguntar a necessidade de realizar um &lt;code>Distinct()&lt;/code> do conteúdo da lista concorrente, bom, isso acontece pois um plugin pode estar listado em mais de uma página, dai não seria legal ter entidades repetidas no nosso conjunto.&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Nota&lt;/strong>: Existem formas muito mais fáceis e inteligentes de se fazer isso, porém, pegar todos os plugins mais famosos dessa forma, é muito mais &lt;em>style&lt;/em> e divertido.&lt;/p>
&lt;/blockquote>
&lt;h1 id="rodando-o-código">Rodando o código&lt;/h1>
&lt;p>Ao executar o código acima (instalando a única depêndencia, que é o &lt;code>AngleSharp&lt;/code>) você terá em menos de dois minutos (caso tiver um processador com no minímo 8 &lt;em>threads&lt;/em>) mais de 1400 plugins baixados no diretório &lt;code>output&lt;/code> à partir do diretório que foi utilizado para compilar e executar o código. Algo nessa vibe:&lt;/p>
&lt;pre>&lt;code>[+] Crawler started with a possible total of 20 thread(s)
[+] Downloaded 76 page(s) with unique plugins from WordPress
[+] Downloaded 1395 plugin page(s)
[+] Downloading file wp-lazy-loading.zip...
[+] Downloading file background-image-cropper.zip...
[+] Downloading file akismet.4.1.10.zip...
[+] Downloading file classic-editor.1.6.1.zip...
[+] Downloading file rollback-update-failure.0.5.3.zip...
[+] Downloading file health-check.1.4.5.zip...
[+] Downloading file wp-jquery-update-test.2.0.0.zip...
...
&lt;/code>&lt;/pre>&lt;p>A sazonalidade da quantidade de plugins disponíveis para download pode variar bastante dependendo de como os usuários do WordPress utilizam os pluginss, mas a aplicação tende a funcionar até que aconteça alguma grande mudança nas telas do próprio site do WordPress.&lt;/p>
&lt;h1 id="e-sobre-análise">E sobre análise?&lt;/h1>
&lt;p>Caso você só esteja buscando uma CVE para chamar de sua, é bem mais fácil buscar nos plugins com poucos downloads ou mais obscuros na comunidade. Agora, se acredita ter o suficiente para contornar a análise que já é realizada pelo WordPress, tanto automaticamente, quanto manualmente, dependendo da popularidade do plugin, sem contar a análise que a própria cena de segurança da informação faz, esse aqui é o caminho.&lt;/p>
&lt;blockquote>
&lt;p>Todavia, o &lt;code>semgrep&lt;/code> cantará de qualquer forma.&lt;/p>
&lt;/blockquote></content></item><item><title>Hackeando apps financeiros para OSINT (e pela zueira): Tudo pelo PIX!</title><link>https://exception.blog/posts/hackeando-apps-financeiros-para-osint/</link><pubDate>Sun, 10 Jan 2021 16:47:21 -0300</pubDate><guid>https://exception.blog/posts/hackeando-apps-financeiros-para-osint/</guid><description>O PIX foi uma das maiores mudanças que tivemos promovidas pelo BACEN (e por outras instituições financeiras ligadas aos fóruns), que vai promover muita agilidade, simplicidade, e o mais importante segurança. Um dos pontos mais perigosos de vender um produto, ou uma feature dele como sendo algo seguro, é que muitas vezes isso pode ser utilizado contra você.
Para não focarmos no PIX, e ir direto ao assunto, deixo como recomendação uma postagem feita pelo mestre Anchises lá no blog do posto Ipiranga, você pode encontra-lá aqui, recomendo que faça a leitura do conteúdo, antes de avançar por aqui.</description><content>&lt;p>O PIX foi uma das maiores mudanças que tivemos promovidas pelo BACEN (e por outras instituições financeiras ligadas aos fóruns), que vai promover muita agilidade, simplicidade, e o mais importante segurança. Um dos pontos mais perigosos de vender um produto, ou uma &lt;em>feature&lt;/em> dele como sendo algo seguro, é que muitas vezes isso pode ser utilizado contra você.&lt;/p>
&lt;p>Para não focarmos no PIX, e ir direto ao assunto, deixo como recomendação uma postagem feita pelo mestre Anchises lá no &lt;em>blog do posto Ipiranga&lt;/em>, você pode encontra-lá &lt;a href="https://anchisesbr.blogspot.com/2020/10/seguranca-aspectos-de-seguranca-do-pix.html">aqui&lt;/a>, recomendo que faça a leitura do conteúdo, antes de avançar por aqui.&lt;/p>
&lt;p>Antes de cairmos em cima do banco, ou &lt;em>fintech&lt;/em> que escolhi para efetuar o &lt;em>bypassing&lt;/em> de todas as funcionalidades de segurança da aplicação - ofuscação de payloads não é bala de prata, uma dica importante - vou trazer um trecho do próprio Anchises da sua postagem em seu blog:&lt;/p>
&lt;blockquote>
&lt;p>&lt;a href="https://www.bcb.gov.br/estabilidadefinanceira/pagamentosinstantaneos">Segundo o Banco Central&lt;/a>, o objetivo é oferecer pagamento instantâneo seja tão fácil, simples, intuitiva e rápida quanto realizar um pagamento com dinheiro em espécie. Os pagadores poderão iniciar pagamentos usando chaves ou apelidos para a identificação da conta transacional como o número do telefone celular, o CPF, o CNPJ ou um endereço de e-mail (que devem ser cadastrados no seu banco), por meio de QR Code (estático ou dinâmico) ou com uso da tecnologia NFC (near-field communication) para pagamentos por aproximação.&lt;/p>
&lt;/blockquote>
&lt;p>É importante notarmos esses itens relacionados a como a chave pode ser formada, bem como as informações que são contidas nela. Sua chave PIX, pode ser seu &lt;strong>telefone celular&lt;/strong>, &lt;strong>CPF&lt;/strong>, &lt;strong>CNPJ&lt;/strong>, &lt;strong>endereço de e-mail&lt;/strong> ou uma chave gerada &amp;ldquo;aleatoriamente&amp;rdquo; e vinculada a sua conta.&lt;/p>
&lt;p>Quando alguém realiza uma transferência de valores utilizando o PIX, temos um &lt;code>whois&lt;/code> de quem está por de trás daquela chave, trazendo informações como &lt;strong>nome completo&lt;/strong>, &lt;strong>CPF mascarado&lt;/strong> (na verdade alguns bancos esqueceram dessa parte para clientes da mesma instituição, como sempre, o OSINT agradece, mas acredito que não deveria funcionar dessa forma 👀, ou muitas vezes vazando o número do documento consultando o comprovante de pagamento, que não trazia esse dado para o cliente &lt;em>mobile&lt;/em>) e o &lt;strong>banco do destinatário&lt;/strong>.&lt;/p>
&lt;p>Alguns cenários que podemos mapear fazendo uma análise dessa superfície de ataque, são relativamente pequenos, como encontrar o nome completo de uma pessoa que cadastrou um e-mail como sua chave. Porém para dentro da cena de OSINT, esse é um recurso muito poderoso, especialmente pelas tratativas das famosas pessoas publicamente expostas, já que agora é possível chegar no banco que um político ou milionário guarda sua grana (e também seus &lt;em>offshores&lt;/em>, caso for uma instituição nacional).&lt;/p>
&lt;p>Outro ponto muito interessante que podemos explorar, além de enumerar massivamente chaves PIX, enriquecendo cada vez mais uma lista de e-mails, ou de &lt;em>phishing&lt;/em>, é utilizar-se da função de transferir R$ 0,01 centavos (durante minhas análises, algumas &lt;em>fintechs&lt;/em> me permitiram inclusive adicionar dinheiro que não existia, tipos fortes são seus amigos, não deixe passar &lt;code>float&lt;/code>, &lt;code>double&lt;/code> e &lt;code>decimal&lt;/code> como a mesma coisa em sua &lt;em>stack&lt;/em>), com o bónus de conter uma mensagem com &lt;strong>qualquer conteúdo&lt;/strong>, e bom, isso é perigoso em diversas formas.&lt;/p>
&lt;blockquote>
&lt;p>Isso inclusive virou meme, e graças a esse meme das mensagens cornas via PIX, que surgiu a maliciosidade nos olhos da galera, para montar campanhas de &lt;em>marketing&lt;/em> totalmente direcionadas, pela bagatela de um centavo a mensagem.&lt;/p>
&lt;/blockquote>
&lt;h1 id="o-escolhido-depois-de-uma-longa-análise-de-outros-candidatos">O escolhido (depois de uma longa análise de outros candidatos)&lt;/h1>
&lt;p>Depois de olhar alguns dos principais meios de pagamento que tinham implementado o PIX, acabei por selecionar uma aplicação Android muito bem escrita para utilizar nos testes (principalmente pois já tinha uma conta aberta lá, que nunca utilizei), foi bom para relembrar muita coisa das magias ocultas que um bom framework de instrumentação pode fazer, nesse caso utilizei o vovô XPOSED, e depois acabei migrando para o Frida já que não precisava trocar nada na ROM padrão do AVD.&lt;/p>
&lt;p>Essa aplicação em especial, me chamou bastante atenção na forma que foi implementado os recursos de segurança, mas um pequeno deslize por parte dos desenvolvedores, permitiram que todas as suas funcionalidades fossem facilmente (na verdade eu levei 5 horas olhando SMALI e umas chamadas malucas do JNI) ignoradas por um famoso &lt;code>try {} catch {}&lt;/code> implementado de forma genérica.&lt;/p>
&lt;p>Como já dizia o ditado, de nada adianta pagar milhões para GuardSquare para deixar seus executáveis devidamente ofuscados, sendo que o &amp;ldquo;feijão com arroz&amp;rdquo; do &lt;em>clean code&lt;/em> não é colocado quando a esteira de desenvolvimento ferve. Na verdade encontrei esse mesmo detalhe em outras aplicações nacionais.&lt;/p>
&lt;p>Nessa mesma aplicação, notei também a falta de sanitização dessa mensagem do PIX, e acabei por escrever um fuzzer para tentar pegar alguma coisa na renderização da mensagem, talvez traga esse item em outra postagem. Enfim, continuando a análise, percebi que o &lt;em>bypass&lt;/em> rolou, graças a forma que essas funções de segurança eram implementadas: Havia uma &lt;em>activity&lt;/em> principal, que era executada antes de todas as outras (no começo parecia uma gambiarra, depois parecia que estava no começo), e quando era feito esse &lt;em>handling&lt;/em> dos estados das telas da aplicação, quando essa principal era instanciada, as verificações de segurança, eram realizadas.&lt;/p>
&lt;p>E devido ao &lt;code>try {} catch {}&lt;/code> do código que tentava carregar essa tela de aviso (sabe aquela famosa &amp;ldquo;&lt;em>por motivos de segurança seu dispositivo Android blá blá blá&lt;/em>&amp;quot;), era pulada uma das exceções possíveis, que era justamente o &lt;em>handle&lt;/em> para a entidade que fazia referência para essa &lt;em>activity&lt;/em> na memória ser nula, caiu para dentro do limbo das exceções genéricas, e o código continua sua vida depois daquilo, então foi literalmente algo similar a isso para contornar esses controles de segurança:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">randomSecurity2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">Java&lt;/span>.&lt;span style="color:#a6e22e">use&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;???&amp;#39;&lt;/span>);
&lt;span style="color:#a6e22e">randomSecurity2&lt;/span>.&lt;span style="color:#f92672">???&lt;/span>.&lt;span style="color:#a6e22e">implementation&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span> () {
&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a ???() called, returning nothing.&amp;#34;&lt;/span>);
}
&lt;span style="color:#a6e22e">randomSecurity2&lt;/span>.&lt;span style="color:#f92672">???&lt;/span>.&lt;span style="color:#a6e22e">implementation&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span> () {
&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;a ???() called, returning nothing.&amp;#34;&lt;/span>);
}
&lt;span style="color:#75715e">// ??? quer dizer que escondi os nomes para evitar problemas.
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Demorei bastante para chegar aqui, devido a ofuscação de código do DexGuard, quebrar os decompiladores clássicos dos executáveis Dalvik, colocando caracteres unicode no meio do nome da função, classe, propriedade etc, fazendo que o decompilador, ao tentar montar o pseudocódigo Java, à partir do SMALI, caia em um &lt;em>loop&lt;/em> de exceções. Ainda bem que podemos criar padrões de &lt;em>hooking&lt;/em> baseados nas assinaturas de tipo das funções, e também enumerar uma classe por essas mesmas características em seu construtor.&lt;/p>
&lt;p>À partir daqui, foi só programar uma extensão para meu proxy para conseguir enviar as requisições para o servidor de &lt;em>backend&lt;/em> com a mesma chave que o cliente original utilizaria para criptografar as &lt;em>payloads&lt;/em> enviadas. Depois de todo esse trabalho, comecei a automatizar as requisições para conseguir, finalmente, fazer o &lt;em>fingerprint&lt;/em> de chaves PIX, e também zuar alguns amigos com centenas de transações de um centavo com frases aleatórias do Chuck Norris (caso um dia tiver um domingo tedioso, recomendo utilizar &lt;a href="https://api.chucknorris.io/">essa API&lt;/a> para azucrinar uns amigos).&lt;/p>
&lt;h1 id="shellscript-e-jq-para-começar-a-automação">ShellScript e &lt;code>jq&lt;/code> para começar a automação&lt;/h1>
&lt;p>Depois de fazer todas as muambas necessárias para fazer o &lt;em>script&lt;/em> funcionar, temos essa belezura em ação:&lt;/p>
&lt;p>&lt;img src="https://i.imgur.com/YdWoOtm.png" alt="PIXMAP funcinando c:">&lt;/p>
&lt;p>E agora era só passar a chave de alguém, e ser feliz:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">➜ automator ./pixmap.sh --key&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;+5511.......&amp;#34;&lt;/span>
&lt;span style="color:#f92672">[&lt;/span>+&lt;span style="color:#f92672">]&lt;/span> Key +5511......., of type PHONE intel:
&amp;gt; ISPB: &lt;span style="color:#ae81ff">18236120&lt;/span>
&amp;gt; Institution: NU PAGAMENTOS S.A.
&amp;gt; Owner: Jonas Uliana
&amp;gt; Owner Type: PERSONAL
&amp;gt; Document: 000........
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Só substitui meus dados por pontos, assim que alguns bancos responderem adequadamente sobre alguns pontos que notei de bem perigoso na arvore de riscos ao analisar o fluxo transacional do PIX, irei também deixar o &lt;em>script&lt;/em>, e uma ferramenta de OSINT (isso é OSINT? Não sei dizer muito bem) decente de fato para azucrinar seus amigos e enriquecer a lista de phishing da empresa.&lt;/p>
&lt;h1 id="minhas-conclusões">Minhas conclusões&lt;/h1>
&lt;p>Ainda está se popularizando, cada vez mais com maior adoções e popularidade, mas te todos os testes que fiz em diferentes meios de pagamentos (incluindo bancos, &lt;em>fintechs&lt;/em> e tudo mais), é visível que existe muita falta de maturidade dos modelos de risco ao lidar com fluxos fraudulentos ou anómalos dentro do PIX.&lt;/p>
&lt;p>Outro ponto que não sei dizer se é um risco, ou uma regra de negócio à ser seguida do BACEN, é a permissão de uma conta poder pesquisar centenas de milhares de outras chaves PIX de uma só vez. Notei que nenhuma instituição tinha implementado controles de &lt;em>rate limiting&lt;/em> ou similares, diretamente em suas APIs. A propósito, foi bem legal notar diversas dessas empresas utilizando GraphQL, eu particularmente prefiro bastante, e acredito que qualquer um que desenvolva &lt;em>frontend&lt;/em> compartilhe desse mesmo sentimento.&lt;/p>
&lt;p>E sobre bloquear o aceite de mensagens no PIX? Bom, acredito que isso pode ser implementado no meio de pagamento, não quero receber mensagens de ameaça/marketing ou nada do tipo, ainda que isso implique em ganhar alguns centavos. Meus amigos que caíram na minha zueira, fizeram 10 reais cada, mas para totalizar essa grana, tomaram 1000 transações PIX com frases do Chuck Norris.&lt;/p></content></item></channel></rss>
<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hackeando apps financeiros para OSINT (e pela zueira): Tudo pelo PIX! | Jojo's Exception</title><meta name=keywords content><meta name=description content="O PIX foi uma das maiores mudan√ßas que tivemos promovidas pelo BACEN (e por outras institui√ß√µes financeiras ligadas aos f√≥runs), que vai promover muita agilidade, simplicidade, e o mais importante seguran√ßa. Um dos pontos mais perigosos de vender um produto, ou uma feature dele como sendo algo seguro, √© que muitas vezes isso pode ser utilizado contra voc√™.
Para n√£o focarmos no PIX, e ir direto ao assunto, deixo como recomenda√ß√£o uma postagem feita pelo mestre Anchises l√° no blog do posto Ipiranga, voc√™ pode encontra-l√° aqui, recomendo que fa√ßa a leitura do conte√∫do, antes de avan√ßar por aqui."><meta name=author content="Jojo"><link rel=canonical href=https://exception.blog/posts/hackeando-apps-financeiros-para-osint/><link href=https://exception.blog/assets/css/stylesheet.min.19d8234f7520f2216aca845b9f292982671403accc7e754ceb099b228a5980fe.css integrity="sha256-GdgjT3Ug8iFqyoRbnykpgmcUA6zMfnVM6wmbIopZgP4=" rel="preload stylesheet" as=style><link rel=icon href=https://exception.blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://exception.blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://exception.blog/favicon-32x32.png><link rel=apple-touch-icon href=https://exception.blog/apple-touch-icon.png><link rel=mask-icon href=https://exception.blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.0"><meta property="og:title" content="Hackeando apps financeiros para OSINT (e pela zueira): Tudo pelo PIX!"><meta property="og:description" content="O PIX foi uma das maiores mudan√ßas que tivemos promovidas pelo BACEN (e por outras institui√ß√µes financeiras ligadas aos f√≥runs), que vai promover muita agilidade, simplicidade, e o mais importante seguran√ßa. Um dos pontos mais perigosos de vender um produto, ou uma feature dele como sendo algo seguro, √© que muitas vezes isso pode ser utilizado contra voc√™.
Para n√£o focarmos no PIX, e ir direto ao assunto, deixo como recomenda√ß√£o uma postagem feita pelo mestre Anchises l√° no blog do posto Ipiranga, voc√™ pode encontra-l√° aqui, recomendo que fa√ßa a leitura do conte√∫do, antes de avan√ßar por aqui."><meta property="og:type" content="article"><meta property="og:url" content="https://exception.blog/posts/hackeando-apps-financeiros-para-osint/"><meta property="article:published_time" content="2021-01-10T16:47:21-03:00"><meta property="article:modified_time" content="2021-01-10T16:47:21-03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hackeando apps financeiros para OSINT (e pela zueira): Tudo pelo PIX!"><meta name=twitter:description content="O PIX foi uma das maiores mudan√ßas que tivemos promovidas pelo BACEN (e por outras institui√ß√µes financeiras ligadas aos f√≥runs), que vai promover muita agilidade, simplicidade, e o mais importante seguran√ßa. Um dos pontos mais perigosos de vender um produto, ou uma feature dele como sendo algo seguro, √© que muitas vezes isso pode ser utilizado contra voc√™.
Para n√£o focarmos no PIX, e ir direto ao assunto, deixo como recomenda√ß√£o uma postagem feita pelo mestre Anchises l√° no blog do posto Ipiranga, voc√™ pode encontra-l√° aqui, recomendo que fa√ßa a leitura do conte√∫do, antes de avan√ßar por aqui."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hackeando apps financeiros para OSINT (e pela zueira): Tudo pelo PIX!","name":"Hackeando apps financeiros para OSINT (e pela zueira): Tudo pelo PIX!","description":"O PIX foi uma das maiores mudan√ßas que tivemos promovidas pelo BACEN (e por outras institui√ß√µes financeiras ligadas aos f√≥runs), que vai promover muita agilidade, simplicidade, e o ‚Ä¶","keywords":[],"articleBody":"O PIX foi uma das maiores mudan√ßas que tivemos promovidas pelo BACEN (e por outras institui√ß√µes financeiras ligadas aos f√≥runs), que vai promover muita agilidade, simplicidade, e o mais importante seguran√ßa. Um dos pontos mais perigosos de vender um produto, ou uma feature dele como sendo algo seguro, √© que muitas vezes isso pode ser utilizado contra voc√™.\nPara n√£o focarmos no PIX, e ir direto ao assunto, deixo como recomenda√ß√£o uma postagem feita pelo mestre Anchises l√° no blog do posto Ipiranga, voc√™ pode encontra-l√° aqui, recomendo que fa√ßa a leitura do conte√∫do, antes de avan√ßar por aqui.\nAntes de cairmos em cima do banco, ou fintech que escolhi para efetuar o bypassing de todas as funcionalidades de seguran√ßa da aplica√ß√£o - ofusca√ß√£o de payloads n√£o √© bala de prata, uma dica importante - vou trazer um trecho do pr√≥prio Anchises da sua postagem em seu blog:\n Segundo o Banco Central, o objetivo √© oferecer pagamento instant√¢neo seja t√£o f√°cil, simples, intuitiva e r√°pida quanto realizar um pagamento com dinheiro em esp√©cie. Os pagadores poder√£o iniciar pagamentos usando chaves ou apelidos para a identifica√ß√£o da conta transacional como o n√∫mero do telefone celular, o CPF, o CNPJ ou um endere√ßo de e-mail (que devem ser cadastrados no seu banco), por meio de QR Code (est√°tico ou din√¢mico) ou com uso da tecnologia NFC (near-field communication) para pagamentos por aproxima√ß√£o.\n √â importante notarmos esses itens relacionados a como a chave pode ser formada, bem como as informa√ß√µes que s√£o contidas nela. Sua chave PIX, pode ser seu telefone celular, CPF, CNPJ, endere√ßo de e-mail ou uma chave gerada ‚Äúaleatoriamente‚Äù e vinculada a sua conta.\nQuando algu√©m realiza uma transfer√™ncia de valores utilizando o PIX, temos um whois de quem est√° por de tr√°s daquela chave, trazendo informa√ß√µes como nome completo, CPF mascarado (na verdade alguns bancos esqueceram dessa parte para clientes da mesma institui√ß√£o, como sempre, o OSINT agradece, mas acredito que n√£o deveria funcionar dessa forma üëÄ, ou muitas vezes vazando o n√∫mero do documento consultando o comprovante de pagamento, que n√£o trazia esse dado para o cliente mobile) e o banco do destinat√°rio.\nAlguns cen√°rios que podemos mapear fazendo uma an√°lise dessa superf√≠cie de ataque, s√£o relativamente pequenos, como encontrar o nome completo de uma pessoa que cadastrou um e-mail como sua chave. Por√©m para dentro da cena de OSINT, esse √© um recurso muito poderoso, especialmente pelas tratativas das famosas pessoas publicamente expostas, j√° que agora √© poss√≠vel chegar no banco que um pol√≠tico ou milion√°rio guarda sua grana (e tamb√©m seus offshores, caso for uma institui√ß√£o nacional).\nOutro ponto muito interessante que podemos explorar, al√©m de enumerar massivamente chaves PIX, enriquecendo cada vez mais uma lista de e-mails, ou de phishing, √© utilizar-se da fun√ß√£o de transferir R$ 0,01 centavos (durante minhas an√°lises, algumas fintechs me permitiram inclusive adicionar dinheiro que n√£o existia, tipos fortes s√£o seus amigos, n√£o deixe passar float, double e decimal como a mesma coisa em sua stack), com o b√≥nus de conter uma mensagem com qualquer conte√∫do, e bom, isso √© perigoso em diversas formas.\n Isso inclusive virou meme, e gra√ßas a esse meme das mensagens cornas via PIX, que surgiu a maliciosidade nos olhos da galera, para montar campanhas de marketing totalmente direcionadas, pela bagatela de um centavo a mensagem.\n O escolhido (depois de uma longa an√°lise de outros candidatos) Depois de olhar alguns dos principais meios de pagamento que tinham implementado o PIX, acabei por selecionar uma aplica√ß√£o Android muito bem escrita para utilizar nos testes (principalmente pois j√° tinha uma conta aberta l√°, que nunca utilizei), foi bom para relembrar muita coisa das magias ocultas que um bom framework de instrumenta√ß√£o pode fazer, nesse caso utilizei o vov√¥ XPOSED, e depois acabei migrando para o Frida j√° que n√£o precisava trocar nada na ROM padr√£o do AVD.\nEssa aplica√ß√£o em especial, me chamou bastante aten√ß√£o na forma que foi implementado os recursos de seguran√ßa, mas um pequeno deslize por parte dos desenvolvedores, permitiram que todas as suas funcionalidades fossem facilmente (na verdade eu levei 5 horas olhando SMALI e umas chamadas malucas do JNI) ignoradas por um famoso try {} catch {} implementado de forma gen√©rica.\nComo j√° dizia o ditado, de nada adianta pagar milh√µes para GuardSquare para deixar seus execut√°veis devidamente ofuscados, sendo que o ‚Äúfeij√£o com arroz‚Äù do clean code n√£o √© colocado quando a esteira de desenvolvimento ferve. Na verdade encontrei esse mesmo detalhe em outras aplica√ß√µes nacionais.\nNessa mesma aplica√ß√£o, notei tamb√©m a falta de sanitiza√ß√£o dessa mensagem do PIX, e acabei por escrever um fuzzer para tentar pegar alguma coisa na renderiza√ß√£o da mensagem, talvez traga esse item em outra postagem. Enfim, continuando a an√°lise, percebi que o bypass rolou, gra√ßas a forma que essas fun√ß√µes de seguran√ßa eram implementadas: Havia uma activity principal, que era executada antes de todas as outras (no come√ßo parecia uma gambiarra, depois parecia que estava no come√ßo), e quando era feito esse handling dos estados das telas da aplica√ß√£o, quando essa principal era instanciada, as verifica√ß√µes de seguran√ßa, eram realizadas.\nE devido ao try {} catch {} do c√≥digo que tentava carregar essa tela de aviso (sabe aquela famosa ‚Äúpor motivos de seguran√ßa seu dispositivo Android bl√° bl√° bl√°\"), era pulada uma das exce√ß√µes poss√≠veis, que era justamente o handle para a entidade que fazia refer√™ncia para essa activity na mem√≥ria ser nula, caiu para dentro do limbo das exce√ß√µes gen√©ricas, e o c√≥digo continua sua vida depois daquilo, ent√£o foi literalmente algo similar a isso para contornar esses controles de seguran√ßa:\nvar randomSecurity2 = Java.use('???'); randomSecurity2.???.implementation = function () { console.log(\"a ???() called, returning nothing.\"); } randomSecurity2.???.implementation = function () { console.log(\"a ???() called, returning nothing.\"); } // ??? quer dizer que escondi os nomes para evitar problemas. Demorei bastante para chegar aqui, devido a ofusca√ß√£o de c√≥digo do DexGuard, quebrar os decompiladores cl√°ssicos dos execut√°veis Dalvik, colocando caracteres unicode no meio do nome da fun√ß√£o, classe, propriedade etc, fazendo que o decompilador, ao tentar montar o pseudoc√≥digo Java, √† partir do SMALI, caia em um loop de exce√ß√µes. Ainda bem que podemos criar padr√µes de hooking baseados nas assinaturas de tipo das fun√ß√µes, e tamb√©m enumerar uma classe por essas mesmas caracter√≠sticas em seu construtor.\n√Ä partir daqui, foi s√≥ programar uma extens√£o para meu proxy para conseguir enviar as requisi√ß√µes para o servidor de backend com a mesma chave que o cliente original utilizaria para criptografar as payloads enviadas. Depois de todo esse trabalho, comecei a automatizar as requisi√ß√µes para conseguir, finalmente, fazer o fingerprint de chaves PIX, e tamb√©m zuar alguns amigos com centenas de transa√ß√µes de um centavo com frases aleat√≥rias do Chuck Norris (caso um dia tiver um domingo tedioso, recomendo utilizar essa API para azucrinar uns amigos).\nShellScript e jq para come√ßar a automa√ß√£o Depois de fazer todas as muambas necess√°rias para fazer o script funcionar, temos essa belezura em a√ß√£o:\nE agora era s√≥ passar a chave de algu√©m, e ser feliz:\n‚ûú automator ./pixmap.sh --key=\"+5511.......\" [+] Key +5511......., of type PHONE intel:  ISPB: 18236120  Institution: NU PAGAMENTOS S.A.  Owner: Jonas Uliana  Owner Type: PERSONAL  Document: 000........ S√≥ substitui meus dados por pontos, assim que alguns bancos responderem adequadamente sobre alguns pontos que notei de bem perigoso na arvore de riscos ao analisar o fluxo transacional do PIX, irei tamb√©m deixar o script, e uma ferramenta de OSINT (isso √© OSINT? N√£o sei dizer muito bem) decente de fato para azucrinar seus amigos e enriquecer a lista de phishing da empresa.\nMinhas conclus√µes Ainda est√° se popularizando, cada vez mais com maior ado√ß√µes e popularidade, mas te todos os testes que fiz em diferentes meios de pagamentos (incluindo bancos, fintechs e tudo mais), √© vis√≠vel que existe muita falta de maturidade dos modelos de risco ao lidar com fluxos fraudulentos ou an√≥malos dentro do PIX.\nOutro ponto que n√£o sei dizer se √© um risco, ou uma regra de neg√≥cio √† ser seguida do BACEN, √© a permiss√£o de uma conta poder pesquisar centenas de milhares de outras chaves PIX de uma s√≥ vez. Notei que nenhuma institui√ß√£o tinha implementado controles de rate limiting ou similares, diretamente em suas APIs. A prop√≥sito, foi bem legal notar diversas dessas empresas utilizando GraphQL, eu particularmente prefiro bastante, e acredito que qualquer um que desenvolva frontend compartilhe desse mesmo sentimento.\nE sobre bloquear o aceite de mensagens no PIX? Bom, acredito que isso pode ser implementado no meio de pagamento, n√£o quero receber mensagens de amea√ßa/marketing ou nada do tipo, ainda que isso implique em ganhar alguns centavos. Meus amigos que ca√≠ram na minha zueira, fizeram 10 reais cada, mas para totalizar essa grana, tomaram 1000 transa√ß√µes PIX com frases do Chuck Norris.\n","wordCount":"1457","inLanguage":"en","datePublished":"2021-01-10T16:47:21-03:00","dateModified":"2021-01-10T16:47:21-03:00","author":{"@type":"Person","name":"Jojo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://exception.blog/posts/hackeando-apps-financeiros-para-osint/"},"publisher":{"@type":"Organization","name":"Jojo's Exception","logo":{"@type":"ImageObject","url":"https://exception.blog/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://exception.blog accesskey=h title="Jojo's Exception (Alt + H)">Jojo's Exception</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://exception.blog/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Hackeando apps financeiros para OSINT (e pela zueira): Tudo pelo PIX!</h1><div class=post-description></div><div class=post-meta>January 10, 2021&nbsp;¬∑&nbsp;7 min&nbsp;¬∑&nbsp;Jojo</div></header><div class=post-content><p>O PIX foi uma das maiores mudan√ßas que tivemos promovidas pelo BACEN (e por outras institui√ß√µes financeiras ligadas aos f√≥runs), que vai promover muita agilidade, simplicidade, e o mais importante seguran√ßa. Um dos pontos mais perigosos de vender um produto, ou uma <em>feature</em> dele como sendo algo seguro, √© que muitas vezes isso pode ser utilizado contra voc√™.</p><p>Para n√£o focarmos no PIX, e ir direto ao assunto, deixo como recomenda√ß√£o uma postagem feita pelo mestre Anchises l√° no <em>blog do posto Ipiranga</em>, voc√™ pode encontra-l√° <a href=https://anchisesbr.blogspot.com/2020/10/seguranca-aspectos-de-seguranca-do-pix.html>aqui</a>, recomendo que fa√ßa a leitura do conte√∫do, antes de avan√ßar por aqui.</p><p>Antes de cairmos em cima do banco, ou <em>fintech</em> que escolhi para efetuar o <em>bypassing</em> de todas as funcionalidades de seguran√ßa da aplica√ß√£o - ofusca√ß√£o de payloads n√£o √© bala de prata, uma dica importante - vou trazer um trecho do pr√≥prio Anchises da sua postagem em seu blog:</p><blockquote><p><a href=https://www.bcb.gov.br/estabilidadefinanceira/pagamentosinstantaneos>Segundo o Banco Central</a>, o objetivo √© oferecer pagamento instant√¢neo seja t√£o f√°cil, simples, intuitiva e r√°pida quanto realizar um pagamento com dinheiro em esp√©cie. Os pagadores poder√£o iniciar pagamentos usando chaves ou apelidos para a identifica√ß√£o da conta transacional como o n√∫mero do telefone celular, o CPF, o CNPJ ou um endere√ßo de e-mail (que devem ser cadastrados no seu banco), por meio de QR Code (est√°tico ou din√¢mico) ou com uso da tecnologia NFC (near-field communication) para pagamentos por aproxima√ß√£o.</p></blockquote><p>√â importante notarmos esses itens relacionados a como a chave pode ser formada, bem como as informa√ß√µes que s√£o contidas nela. Sua chave PIX, pode ser seu <strong>telefone celular</strong>, <strong>CPF</strong>, <strong>CNPJ</strong>, <strong>endere√ßo de e-mail</strong> ou uma chave gerada &ldquo;aleatoriamente&rdquo; e vinculada a sua conta.</p><p>Quando algu√©m realiza uma transfer√™ncia de valores utilizando o PIX, temos um <code>whois</code> de quem est√° por de tr√°s daquela chave, trazendo informa√ß√µes como <strong>nome completo</strong>, <strong>CPF mascarado</strong> (na verdade alguns bancos esqueceram dessa parte para clientes da mesma institui√ß√£o, como sempre, o OSINT agradece, mas acredito que n√£o deveria funcionar dessa forma üëÄ, ou muitas vezes vazando o n√∫mero do documento consultando o comprovante de pagamento, que n√£o trazia esse dado para o cliente <em>mobile</em>) e o <strong>banco do destinat√°rio</strong>.</p><p>Alguns cen√°rios que podemos mapear fazendo uma an√°lise dessa superf√≠cie de ataque, s√£o relativamente pequenos, como encontrar o nome completo de uma pessoa que cadastrou um e-mail como sua chave. Por√©m para dentro da cena de OSINT, esse √© um recurso muito poderoso, especialmente pelas tratativas das famosas pessoas publicamente expostas, j√° que agora √© poss√≠vel chegar no banco que um pol√≠tico ou milion√°rio guarda sua grana (e tamb√©m seus <em>offshores</em>, caso for uma institui√ß√£o nacional).</p><p>Outro ponto muito interessante que podemos explorar, al√©m de enumerar massivamente chaves PIX, enriquecendo cada vez mais uma lista de e-mails, ou de <em>phishing</em>, √© utilizar-se da fun√ß√£o de transferir R$ 0,01 centavos (durante minhas an√°lises, algumas <em>fintechs</em> me permitiram inclusive adicionar dinheiro que n√£o existia, tipos fortes s√£o seus amigos, n√£o deixe passar <code>float</code>, <code>double</code> e <code>decimal</code> como a mesma coisa em sua <em>stack</em>), com o b√≥nus de conter uma mensagem com <strong>qualquer conte√∫do</strong>, e bom, isso √© perigoso em diversas formas.</p><blockquote><p>Isso inclusive virou meme, e gra√ßas a esse meme das mensagens cornas via PIX, que surgiu a maliciosidade nos olhos da galera, para montar campanhas de <em>marketing</em> totalmente direcionadas, pela bagatela de um centavo a mensagem.</p></blockquote><h1 id=o-escolhido-depois-de-uma-longa-an√°lise-de-outros-candidatos>O escolhido (depois de uma longa an√°lise de outros candidatos)<a hidden class=anchor aria-hidden=true href=#o-escolhido-depois-de-uma-longa-an√°lise-de-outros-candidatos>#</a></h1><p>Depois de olhar alguns dos principais meios de pagamento que tinham implementado o PIX, acabei por selecionar uma aplica√ß√£o Android muito bem escrita para utilizar nos testes (principalmente pois j√° tinha uma conta aberta l√°, que nunca utilizei), foi bom para relembrar muita coisa das magias ocultas que um bom framework de instrumenta√ß√£o pode fazer, nesse caso utilizei o vov√¥ XPOSED, e depois acabei migrando para o Frida j√° que n√£o precisava trocar nada na ROM padr√£o do AVD.</p><p>Essa aplica√ß√£o em especial, me chamou bastante aten√ß√£o na forma que foi implementado os recursos de seguran√ßa, mas um pequeno deslize por parte dos desenvolvedores, permitiram que todas as suas funcionalidades fossem facilmente (na verdade eu levei 5 horas olhando SMALI e umas chamadas malucas do JNI) ignoradas por um famoso <code>try {} catch {}</code> implementado de forma gen√©rica.</p><p>Como j√° dizia o ditado, de nada adianta pagar milh√µes para GuardSquare para deixar seus execut√°veis devidamente ofuscados, sendo que o &ldquo;feij√£o com arroz&rdquo; do <em>clean code</em> n√£o √© colocado quando a esteira de desenvolvimento ferve. Na verdade encontrei esse mesmo detalhe em outras aplica√ß√µes nacionais.</p><p>Nessa mesma aplica√ß√£o, notei tamb√©m a falta de sanitiza√ß√£o dessa mensagem do PIX, e acabei por escrever um fuzzer para tentar pegar alguma coisa na renderiza√ß√£o da mensagem, talvez traga esse item em outra postagem. Enfim, continuando a an√°lise, percebi que o <em>bypass</em> rolou, gra√ßas a forma que essas fun√ß√µes de seguran√ßa eram implementadas: Havia uma <em>activity</em> principal, que era executada antes de todas as outras (no come√ßo parecia uma gambiarra, depois parecia que estava no come√ßo), e quando era feito esse <em>handling</em> dos estados das telas da aplica√ß√£o, quando essa principal era instanciada, as verifica√ß√µes de seguran√ßa, eram realizadas.</p><p>E devido ao <code>try {} catch {}</code> do c√≥digo que tentava carregar essa tela de aviso (sabe aquela famosa &ldquo;<em>por motivos de seguran√ßa seu dispositivo Android bl√° bl√° bl√°</em>"), era pulada uma das exce√ß√µes poss√≠veis, que era justamente o <em>handle</em> para a entidade que fazia refer√™ncia para essa <em>activity</em> na mem√≥ria ser nula, caiu para dentro do limbo das exce√ß√µes gen√©ricas, e o c√≥digo continua sua vida depois daquilo, ent√£o foi literalmente algo similar a isso para contornar esses controles de seguran√ßa:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>randomSecurity2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Java</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;???&#39;</span>);

<span style=color:#a6e22e>randomSecurity2</span>.<span style=color:#f92672>???</span>.<span style=color:#a6e22e>implementation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;a ???() called, returning nothing.&#34;</span>);
}

<span style=color:#a6e22e>randomSecurity2</span>.<span style=color:#f92672>???</span>.<span style=color:#a6e22e>implementation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;a ???() called, returning nothing.&#34;</span>);
}

<span style=color:#75715e>// ??? quer dizer que escondi os nomes para evitar problemas.
</span></code></pre></div><p>Demorei bastante para chegar aqui, devido a ofusca√ß√£o de c√≥digo do DexGuard, quebrar os decompiladores cl√°ssicos dos execut√°veis Dalvik, colocando caracteres unicode no meio do nome da fun√ß√£o, classe, propriedade etc, fazendo que o decompilador, ao tentar montar o pseudoc√≥digo Java, √† partir do SMALI, caia em um <em>loop</em> de exce√ß√µes. Ainda bem que podemos criar padr√µes de <em>hooking</em> baseados nas assinaturas de tipo das fun√ß√µes, e tamb√©m enumerar uma classe por essas mesmas caracter√≠sticas em seu construtor.</p><p>√Ä partir daqui, foi s√≥ programar uma extens√£o para meu proxy para conseguir enviar as requisi√ß√µes para o servidor de <em>backend</em> com a mesma chave que o cliente original utilizaria para criptografar as <em>payloads</em> enviadas. Depois de todo esse trabalho, comecei a automatizar as requisi√ß√µes para conseguir, finalmente, fazer o <em>fingerprint</em> de chaves PIX, e tamb√©m zuar alguns amigos com centenas de transa√ß√µes de um centavo com frases aleat√≥rias do Chuck Norris (caso um dia tiver um domingo tedioso, recomendo utilizar <a href=https://api.chucknorris.io/>essa API</a> para azucrinar uns amigos).</p><h1 id=shellscript-e-jq-para-come√ßar-a-automa√ß√£o>ShellScript e <code>jq</code> para come√ßar a automa√ß√£o<a hidden class=anchor aria-hidden=true href=#shellscript-e-jq-para-come√ßar-a-automa√ß√£o>#</a></h1><p>Depois de fazer todas as muambas necess√°rias para fazer o <em>script</em> funcionar, temos essa belezura em a√ß√£o:</p><p><img src=https://i.imgur.com/YdWoOtm.png alt="PIXMAP funcinando c:"></p><p>E agora era s√≥ passar a chave de algu√©m, e ser feliz:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>‚ûú  automator ./pixmap.sh --key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;+5511.......&#34;</span>
<span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Key +5511......., of type PHONE intel:
 &gt;  ISPB: <span style=color:#ae81ff>18236120</span>
 &gt;  Institution: NU PAGAMENTOS S.A.
 &gt;  Owner: Jonas Uliana
 &gt;  Owner Type: PERSONAL
 &gt;  Document: 000........

</code></pre></div><p>S√≥ substitui meus dados por pontos, assim que alguns bancos responderem adequadamente sobre alguns pontos que notei de bem perigoso na arvore de riscos ao analisar o fluxo transacional do PIX, irei tamb√©m deixar o <em>script</em>, e uma ferramenta de OSINT (isso √© OSINT? N√£o sei dizer muito bem) decente de fato para azucrinar seus amigos e enriquecer a lista de phishing da empresa.</p><h1 id=minhas-conclus√µes>Minhas conclus√µes<a hidden class=anchor aria-hidden=true href=#minhas-conclus√µes>#</a></h1><p>Ainda est√° se popularizando, cada vez mais com maior ado√ß√µes e popularidade, mas te todos os testes que fiz em diferentes meios de pagamentos (incluindo bancos, <em>fintechs</em> e tudo mais), √© vis√≠vel que existe muita falta de maturidade dos modelos de risco ao lidar com fluxos fraudulentos ou an√≥malos dentro do PIX.</p><p>Outro ponto que n√£o sei dizer se √© um risco, ou uma regra de neg√≥cio √† ser seguida do BACEN, √© a permiss√£o de uma conta poder pesquisar centenas de milhares de outras chaves PIX de uma s√≥ vez. Notei que nenhuma institui√ß√£o tinha implementado controles de <em>rate limiting</em> ou similares, diretamente em suas APIs. A prop√≥sito, foi bem legal notar diversas dessas empresas utilizando GraphQL, eu particularmente prefiro bastante, e acredito que qualquer um que desenvolva <em>frontend</em> compartilhe desse mesmo sentimento.</p><p>E sobre bloquear o aceite de mensagens no PIX? Bom, acredito que isso pode ser implementado no meio de pagamento, n√£o quero receber mensagens de amea√ßa/marketing ou nada do tipo, ainda que isso implique em ganhar alguns centavos. Meus amigos que ca√≠ram na minha zueira, fizeram 10 reais cada, mas para totalizar essa grana, tomaram 1000 transa√ß√µes PIX com frases do Chuck Norris.</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://exception.blog>Jojo's Exception</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=https://exception.blog/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});if(id==="top"){history.replaceState(null,null," ");}else{history.replaceState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>